suite: enable connect clusters and check the changes in secret
templates:
  - deployment.yaml
  - secrets.yaml
tests:
  - it: should work with external enabled
    set:
      lenses:
        connectClusters:
          external: true
    asserts:
      - template: secrets.yaml
        isNull:
          path: stringData.connect\.clusters
      - template: deployment.yaml
        notContains:
          path: spec.template.spec.containers[0].env
          content:
            name: LENSES_KAFKA_CONNECT_CLUSTERS
            valueFrom:
              secretKeyRef:
                key: connect.clusters
                name: RELEASE-NAME
  - it: should work with external enabled
    set:
      lenses:
        connectClusters:
          external: true
        additionalEnv:
          - name: LENSES_KAFKA_CONNECT_CLUSTERS
            valueFrom:
              secretKeyRef:
                name: lenses-super-secrets
                key: lenses-kafka-connect-clusters
    asserts:
      - template: secrets.yaml
        isNull:
          path: stringData.connect\.clusters
      - template: deployment.yaml
        contains:
          path: spec.template.spec.containers[0].env
          content:
            name: LENSES_KAFKA_CONNECT_CLUSTERS
            valueFrom:
              secretKeyRef:
                name: lenses-super-secrets
                key: lenses-kafka-connect-clusters
